services:
  # Traveler - RSS 订阅助手
  traveler:
    build: ./services/traveler
    container_name: openclaw-traveler
    restart: unless-stopped
    ports:
      - "${TRAVELER_PORT:-8788}:${TRAVELER_PORT:-8788}"
    environment:
      # 从环境变量或 .env 文件读取
      OPENCLAW_GATEWAY_URL: ${OPENCLAW_GATEWAY_URL:-}
      OPENCLAW_GATEWAY_TOKEN: ${OPENCLAW_GATEWAY_TOKEN:-}
      ROTE_API_BASE: ${ROTE_API_BASE:-https://api.rote.ink/v2/api}
      ROTE_OPENKEY: ${ROTE_OPENKEY:-}
      TRAVELER_PORT: ${TRAVELER_PORT:-8788}
      TRAVELER_API_TOKEN: ${TRAVELER_API_TOKEN:-}
      TRAVELER_HMAC_SECRET: ${TRAVELER_HMAC_SECRET:-}
      TRAVELER_SCHEDULE_INTERVAL_MINUTES: ${TRAVELER_SCHEDULE_INTERVAL_MINUTES:-0}
      TRAVELER_SCHEDULE_RUN_ON_START: ${TRAVELER_SCHEDULE_RUN_ON_START:-true}
      TRAVELER_DB_PATH: ${TRAVELER_DB_PATH:-.local/state/traveler.db}
      TRAVELER_LOG_LEVEL: ${TRAVELER_LOG_LEVEL:-info}
    volumes:
      - traveler-data:/app/.local
    networks:
      - openclaw

  # Webhookd - GitHub webhook 接收器
  webhookd:
    build: ./services/webhookd
    container_name: openclaw-webhookd
    restart: unless-stopped
    ports:
      - "${WEBHOOKD_PORT:-18787}:${WEBHOOKD_PORT:-18787}"
    environment:
      # 从环境变量或 .env 文件读取
      WEBHOOKD_PORT: ${WEBHOOKD_PORT:-18787}
      GITHUB_WEBHOOK_SECRET: ${GITHUB_WEBHOOK_SECRET:-}
      OPENCLAW_GATEWAY_URL: ${OPENCLAW_GATEWAY_URL:-}
      OPENCLAW_GATEWAY_TOKEN: ${OPENCLAW_GATEWAY_TOKEN:-}
      IGNORE_GITHUB_ACTORS: ${IGNORE_GITHUB_ACTORS:-}
      GITHUB_REPLY_SIGNATURE: ${GITHUB_REPLY_SIGNATURE:-— replied by OpenClaw assistant}
      DEDUPE_TTL_MS: ${DEDUPE_TTL_MS:-3600000}
      WEBHOOKD_LOG_LEVEL: ${WEBHOOKD_LOG_LEVEL:-info}
    volumes:
      - webhookd-data:/app/.local
    networks:
      - openclaw

volumes:
  traveler-data:
  webhookd-data:

networks:
  openclaw:
